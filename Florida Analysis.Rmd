---
title: "Florida"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

### Florida


```{r}
#fl rdd five years after implementation
fl5yrs_rdd <- rdd_data(y=floridamoms$MYEDUC[floridamoms$YEAR == 2010], x = floridamoms$YNGCH[floridamoms$YEAR == 2010], cutpoint = 9)

plot(fl5yrs_rdd)

reg_fl5yrs <- rdd_reg_lm(rdd_object = fl5yrs_rdd, order = 2)
print(reg_fl5yrs)

plot(reg_fl5yrs)

```

```{r}
flfiveyrs <- subset(floridamoms, floridamoms$YEAR == 2010 & 
                      floridamoms$YNGCH >= 6 & floridamoms$YNGCH <= 12)
rdplot(y = flfiveyrs$MYEDUC, x = flfiveyrs$YNGCH, c = 9, p = 1,
       x.label = "Age of youngest child (before 11 years old = had access to 
       preschool at 4 years old)", y.label = "Years of school attended", 
       title = "5 years after the implementation of Florida's preschool 
       program")
```

```{r}
#rd analysis
rdd_data(y = flfiveyrs$MYEDUC, 
         x = flfiveyrs$YNGCH, 
         cutpoint = 9) %>% 
  rdd_reg_lm(slope = "separate") %>% 
  summary()
```

```{r}
rdrobust(y = flfiveyrs$MYEDUC, x = flfiveyrs$YNGCH, c = 9, p = 1)

```

```{r}
#fl rdd ten years after implementation
fltenyrs <- subset(floridamoms, floridamoms$YEAR == 2015 & 
                     floridamoms$YNGCH >= 11 & floridamoms$YNGCH <= 17)
rdplot(y = fltenyrs$MYEDUC, x = fltenyrs$YNGCH, c = 14, nbins = 50, p = 1, 
       x.label = "Age of youngest child (before 14 years old = had access to 
       preschool at 4 years old)", y.label = "Years of school attended", 
       title = "10 years after the implementation of Florida's preschool 
       program")
```

```{r}
rdd_data(y = fltenyrs$MYEDUC, 
         x = fltenyrs$YNGCH, 
         cutpoint = 14) %>% 
  rdd_reg_lm(slope = "separate") %>% 
  summary()
```

Florida implemented its preschool program in 2005, and Georgia had a
program implemented before 2000 (so there were no changes during the
treatment period).

```{r Florida DiD regression 1}
florida_analysis <- rbind(floridamoms, georgiamoms)
florida_analysis <- select(florida_analysis, YEAR, HHWT, STATEICP, HHINCOME, PERWT, YNGCH, AGE, MARST, RACE, immigrant, MYEDUC)

#treat = 1 when the unit is treated or has ever been treated (state == 12 and year >= 2005 and youngest child <= 4 in 2005, <= 5 in 2006, <= 6 in 2007, <=7 in 2007, <=8 in 2013, <= 9 in 2014, <=10 in 2015, <= 11 in 2016, <= 12 in 2017, <= 13 in 2018, <= 14 in 2019)

florida_analysis$treat <- 0

florida_analysis$treat[florida_analysis$YEAR ==2005 & florida_analysis$YNGCH <= 4 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2006 & florida_analysis$YNGCH <= 5 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2007 & florida_analysis$YNGCH <= 6 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2008 & florida_analysis$YNGCH <= 7 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2009 & florida_analysis$YNGCH <= 8 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2010 & florida_analysis$YNGCH <= 9 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2011 & florida_analysis$YNGCH <= 10 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2012 & florida_analysis$YNGCH <= 11 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2013 & florida_analysis$YNGCH <= 12 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2014 & florida_analysis$YNGCH <= 13 & florida_analysis$STATEICP == 43] <- 1
florida_analysis$treat[florida_analysis$YEAR ==2015 & florida_analysis$YNGCH <= 14 & florida_analysis$STATEICP == 43] <- 1

#time = 1 when the unit hasn't been treated - 3 in 2005, 4 in 2006, 5 in 2007, etc
florida_analysis$time <- 0

florida_analysis$time[florida_analysis$YEAR ==2005 & florida_analysis$YNGCH <= 3] <- 1
florida_analysis$time[florida_analysis$YEAR ==2006 & florida_analysis$YNGCH <= 4] <- 1
florida_analysis$time[florida_analysis$YEAR ==2007 & florida_analysis$YNGCH <= 5] <- 1
florida_analysis$time[florida_analysis$YEAR ==2008 & florida_analysis$YNGCH <= 6] <- 1
florida_analysis$time[florida_analysis$YEAR ==2009 & florida_analysis$YNGCH <= 7] <- 1
florida_analysis$time[florida_analysis$YEAR ==2010 & florida_analysis$YNGCH <= 8] <- 1
florida_analysis$time[florida_analysis$YEAR ==2011 & florida_analysis$YNGCH <= 9] <- 1
florida_analysis$time[florida_analysis$YEAR ==2012 & florida_analysis$YNGCH <= 10] <- 1
florida_analysis$time[florida_analysis$YEAR ==2013 & florida_analysis$YNGCH <= 11] <- 1
florida_analysis$time[florida_analysis$YEAR ==2014 & florida_analysis$YNGCH <= 12] <- 1
florida_analysis$time[florida_analysis$YEAR ==2015 & florida_analysis$YNGCH <= 13] <- 1
florida_analysis$time[florida_analysis$YEAR ==2016 & florida_analysis$YNGCH <= 14] <- 1
florida_analysis$time[florida_analysis$YEAR ==2017 & florida_analysis$YNGCH <= 15] <- 1
florida_analysis$time[florida_analysis$YEAR ==2018 & florida_analysis$YNGCH <= 16] <- 1
florida_analysis$time[florida_analysis$YEAR ==2019 & florida_analysis$YNGCH <= 17] <- 1

```

```{r Florida DiD regression 2}
#regression, treatement effect = time*treat
florida_DiD <- glm(MYEDUC ~ treat + time + treat*time, data = florida_analysis, weights = florida_analysis$PERWT)
summary(florida_DiD)
```


```{r}
educ_fl <- aggregate(floridamoms$MYEDUC ~ floridamoms$YEAR, FUN = mean)
educ_ga <- aggregate(georgiamoms$MYEDUC ~ georgiamoms$YEAR, FUN = mean)

educdid_fl<- cbind(educ_fl$`floridamoms$YEAR`, educ_fl$`floridamoms$MYEDUC`, educ_ga$`georgiamoms$MYEDUC`)
educdid_fl<- data.frame(educdid_fl)

ggplot(educdid_fl, aes(X1)) +             # basic graphical object
  geom_line(aes(y=X2), colour="red") +  # first layer
  geom_line(aes(y=X3), colour="blue")+
  geom_vline(xintercept=2005)
```


```{r}
#florida DiD
moms9 <- subset(moms, moms$YNGCH == 9)
fl2005 <- mean(moms9$EDUC[moms9$STATEICP == 43 & moms9$YEAR == 2005])
ga2005 <- mean(moms9$EDUC[moms9$STATEICP == 44 & moms9$YEAR == 2005])

fl2010 <- mean(moms9$EDUC[moms9$STATEICP == 43 & moms9$YEAR == 2010])
ga2010 <- mean(moms9$EDUC[moms9$STATEICP == 44 & moms9$YEAR == 2010])

#make a table
fldifdif1 <- data.frame(FL = c(fl2005, fl2010), GA = c(ga2005, ga2010), 
                        row.names = c("before", "after"))
fldifdif1
```

```{r}
#plot the table
matplot(fldifdif1, type = "b",pch=1 , xlab = "Year", xaxt='n',
        main = "Moms with 8 and 9 year olds in Florida and Georgia" )
axis(side = 1, at = 1:2, labels = c("2005", "2010"))
legend("topright", c("FL", "GA"), pch = 1, col = rep(c(1,2), 2))
```

------------------------------------------------------------------------

Florida PUMAs \* 2000: 01101, 01102, 01103, 01104, 00900, 00800, 00600,
00400, 00702, 00701 \* 2010: 08900, 03101, 03102, 03103, 03104, 02300,
12100, 06300, 07300, 07301

Georgia PUMAs: \* 2000: 03800, 03700, 04300, 04200, 04100, 03900 \*
2010: 00100, 00500, 00600, 00700, 00800, 01100

```{r}
#Florida PUMA DiD
pumafl <- subset(moms9, moms9$STATEICP == 43)
pumafl <- subset(pumafl, pumafl$PUMA == 1101 | pumafl$PUMA == 1102| 
                   pumafl$PUMA == 1103| pumafl$PUMA == 1104| pumafl$PUMA == 900|
                   pumafl$PUMA == 800| pumafl$PUMA == 600 | pumafl$PUMA == 400| 
                   pumafl$PUMA == 702| pumafl$PUMA == 701 | pumafl$PUMA == 8900|
                   pumafl$PUMA == 3101| pumafl$PUMA == 3102| pumafl$PUMA == 3101|
                   pumafl$PUMA == 3104| pumafl$PUMA == 2300| pumafl$PUMA == 12100
                 | pumafl$PUMA == 6300 | pumafl$PUMA == 7300 | 
                   pumafl$PUMA == 7301)

fl2005p<- mean(pumafl$EDUC[pumafl$YEAR == 2005])
fl2010p<- mean(pumafl$EDUC[pumafl$YEAR == 2010])

pumaga <- subset(moms9, moms9$STATEICP == 44)
pumaga <- subset(pumaga, pumaga$PUMA == 3800 | pumaga$PUMA == 3700 | 
                   pumaga$PUMA == 4300 | pumaga$PUMA == 4100 | 
                   pumaga$PUMA == 3900 | pumaga$PUMA == 100 | pumaga$PUMA == 500
                 | pumaga$PUMA == 600 | pumaga$PUMA == 700 | pumaga$PUMA == 800 
                 | pumaga$PUMA == 1100)

ga2005p <- mean(pumaga$EDUC[pumaga$YEAR == 2005])
ga2010p <- mean(pumaga$EDUC[pumaga$YEAR == 2010])

#make a table
fldifdifp <- data.frame(FL = c(fl2005p, fl2010p), GA = c(ga2005p, ga2010p), 
                        row.names = c("before", "after"))
fldifdifp

#plot the table
matplot(fldifdifp, type = "b",pch=1 , xlab = "Year", xaxt='n', 
        main = "Moms with 8 and 9 year olds in Florida and Georgia 
        PUMAs near the state border" )
axis(side = 1, at = 1:2, labels = c("2005", "2010"))
legend("bottomleft", c("FL", "GA"), pch = 1, col = rep(c(1,2), 2))
```

```{r}
#moms with 13 year olds in fl and ga, neither are exposed to treatment
moms13 <- subset(moms, moms$YNGCH == 13)

#florida
pumafl13 <- subset(moms13, moms13$STATEICP == 12)
pumafl13 <- subset(pumafl13, pumafl13$PUMA == 1101 | pumafl13$PUMA == 1102| 
                     pumafl13$PUMA == 1103| pumafl13$PUMA == 1104| 
                     pumafl13$PUMA == 900| pumafl13$PUMA == 800| 
                     pumafl13$PUMA == 600 | pumafl13$PUMA == 400| 
                     pumafl13$PUMA == 702| pumafl13$PUMA == 701 | 
                     pumafl13$PUMA == 8900| pumafl13$PUMA == 3101| 
                     pumafl13$PUMA == 3102| pumafl13$PUMA == 3101| 
                     pumafl13$PUMA == 3104| pumafl13$PUMA == 2300| 
                     pumafl13$PUMA == 12100 | pumafl13$PUMA == 6300 | 
                     pumafl13$PUMA == 7300 | pumafl13$PUMA == 7301)

fl2005p13<- mean(pumafl13$EDUC[pumafl13$YEAR == 2005])
fl2010p13<- mean(pumafl13$EDUC[pumafl13$YEAR == 2010])

#georgia
pumaga13 <- subset(moms14, moms14$STATEICP == 13)
pumaga13 <- subset(pumaga13, pumaga13$PUMA == 3800 | pumaga13$PUMA == 3700 | 
                     pumaga13$PUMA == 4300 | pumaga13$PUMA == 4100 | 
                     pumaga13$PUMA == 3900 | pumaga13$PUMA == 100 | 
                     pumaga13$PUMA == 500 | pumaga13$PUMA == 600 | 
                     pumaga13$PUMA == 700 | pumaga13$PUMA == 800 | 
                     pumaga13$PUMA == 1100)

ga2005p13 <- mean(pumaga13$EDUC[pumaga13$YEAR == 2005])
ga2010p13 <- mean(pumaga13$EDUC[pumaga13$YEAR == 2010])

#make a table
fldifdifp13 <- data.frame(FL = c(fl2005p13, fl2010p13), 
                          GA = c(ga2005p13, ga2010p13), 
                          row.names = c("before", "after"))
fldifdifp13

#plot the table
matplot(fldifdifp13, type = "b",pch=1 , xlab = "Year", xaxt='n', 
        main = "Moms with 12 and 13 year olds in Florida and 
        Georgia PUMAs near the state border" )
axis(side = 1, at = 1:2, labels = c("2005", "2010"))
legend("topleft", c("FL", "GA"), pch = 1, col = rep(c(1,2), 2))
```

```{r}
#Florida dif in dif in dif calculation

#DiD, treated v. untreated
fldid1p <- (fl2010p-fl2005p) - (ga2010p-ga2005p)
print(c("Difference-in-difference, 8 and 9 year olds:", fldid1p))

#DiD, untreated v. untreated
fldid2p <- (fl2010p13-fl2005p13) - (ga2010p13-ga2005p13)
print(c("Difference-in-difference, 12 and 13 year olds:", fldid2p))

#DiDiD
fldididp <- fldid1p-fldid2p
print(c("Difference-in-difference-in-difference: ", fldididp))
```


```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

